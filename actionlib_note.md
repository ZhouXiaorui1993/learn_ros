# Actionlib学习笔记

## 概述

虽然ROS服务可以不通过主题来实现和节点之间的直接通讯（向节点发送请求并接收回应），但在某些情况下，服务需要执行很长时间，而且用户希望在执行过程中取消请求，或得到关于请求进展情况的定期反馈。此时基本的服务已经不能满足用户的需求了。

Actionlib包则提供了创建服务器的工具，这些服务器执行可被抢占的长时间的目标。此外，它还提供了一个客户端接口，以便向服务器发送请求。

## 客户端与服务器的交互

ActionClient和ActionServer通过“ROS行为协议（ROS Action Protocol）”进行通信，该协议是建立在ROS消息上的。同时，客户端和服务器还提供了一个简单的API，用于在客户端请求目标或在服务器端通过函数调用和回调执行目标。


## 行为规范：Goal，Feedback和Result

为便于客户端和服务器进行通信，需要定义通信消息的规范，如下：

- Goal：为使用行为完成任务，引入了目标的概念。它可以通过一个ActionClient发送到一个ActionServer。例如，为了移动机器人，可以设置目标为一个PoseStamped类型的消息，它包括机器人的目标位置；而为了控制激光雷达，目标会是激光雷达的参数（最大角度、最小角度、扫描速度等）。

- Feedback：服务器可以使用反馈来告诉客户端目标进行的情况。在移动机器人时，反馈可以是机器人在路径上的姿态；控制激光雷达时，服务可以是扫描完成之前的时间。

- Result：完成目标后，服务器会将结果发送客户端，与反馈不同的是，结果只发送一次。当action的目的是提供某种信息时，这是非常重要的，例如激光雷达产生的点云信息。

## .action文件

行文规范使用.action文件，包括目标定义、结果定义和反馈定义，两两之间用`---`分开。

这些文件位于package的action目录下。下面是一个例子，`DoDishes.action`:
```
    # 定义目标
    uint32 dishwasher_id  # 指明要用的washer
    ---
    # 定义结果
    uint32 total_dishes_cleaned  # 共洗的盘子数量
    ---
    # 定义反馈
    float32 percent_complete  # 完成率
```



